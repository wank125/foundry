# Health Checks 概览

> 更新时间：2025-12-28
> 文档来源：https://palantir.com/docs/foundry/health-checks/overview/

## 概述

**Health Checks（健康检查）** 允许对数据集和其他资源类型的常见问题进行监控和警报。您可以使用可自定义的检查监控与数据集状态、时间、大小、内容和架构相关的潜在问题。当检测到问题时，您将收到平台内通知和电子邮件警报。

## 核心功能

### 1. 监控能力

Health Checks 可以监控以下方面的问题：

| 监控类别 | 说明 |
|---------|------|
| **数据集状态** | 构建失败、数据集过期 |
| **时间** | 数据新鲜度、更新频率 |
| **大小** | 数据集大小异常、行数变化 |
| **内容** | 空值、重复值、数据范围 |
| **架构** | 架构变更、列类型变化 |

### 2. 警报机制

- **平台内通知**：在 Foundry 中显示通知
- **电子邮件警报**：发送电子邮件警报
- **问题详情**：提供详细的问题信息

## 支持的资源类型

Health Checks 可以为以下资源创建检查：

```
┌─────────────────────────────────────────────────────────────┐
│             Health Checks 支持的资源                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. Datasets（数据集）                                       │
│     ├── 表格数据                                           │
│     ├── 时序数据                                           │
│     └── 也可以通过代码创建                                 │
│                                                             │
│  2. Schedules（计划）                                       │
│     ├── 构建计划                                           │
│     ├── 流式处理计划                                       │
│     └── 自动化计划                                         │
│                                                             │
│  3. Tables（表格）                                          │
│     ├── 虚拟表格                                           │
│     └── Iceberg 表格                                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 创建和配置健康检查

### 位置

Health 选项卡的位置取决于资源类型：

#### 数据集
在 Dataset Preview 中查看数据集时，导航到 **Health** 选项卡以：
- 添加新检查
- 修改现有检查
- 查看历史检查结果

#### 计划
在 Data Lineage 中打开计划时，选择 **Metrics > Health** 以查看：
- 健康检查
- 监控视图
- 每个都在自己的视图中列出

#### 表格
在 Dataset Preview 中查看表格时，导航到 **Health** 选项卡以：
- 添加新检查
- 修改现有检查
- 查看历史检查结果

### Data Health 应用

在 Data Health 应用的 **Health** 选项卡上可以找到特定资源类型可用的检查。查看监控规则参考以了解可用的检查。

## 查看健康状态

### 不同级别的健康查看

#### 1. Pipeline Health（管道健康）

在 **Data Lineage** 中：
- 数据集可以按其健康检查状态着色
- 页面底部的 **Data Health** 选项卡（在设置中切换）显示血统图中所有数据集的健康检查及其状态

#### 2. Project-wide Health（项目范围健康）

在每个 **Project catalog** 选项卡上：
- **Project maintenance** 部分显示应用于项目中任何数据集的所有健康检查
- 显示通过或失败的检查数量摘要

#### 3. Platform-wide Health（平台范围健康）

要查看所有数据集的健康检查概览：
- 从侧边栏选择 **Data Health** 应用
- 可以按状态或名称过滤或排序数据集
- 可以切换以仅显示您正在观看的数据集
- 通过选择右上角的 **Add health check** 添加新的健康检查

## 检查类型

### 常见检查类型

#### 数据集检查
- **数据集已过时**：检查数据集是否超过预期时间未更新
- **数据集不存在**：检查数据集是否存在
- **数据集为空**：检查数据集是否为空
- **行数检查**：检查行数是否在预期范围内
- **架构变更**：检测架构变更

#### 内容检查
- **空值检查**：检查列中的空值比例
- **唯一值检查**：检查唯一值的数量
- **范围检查**：检查值是否在预期范围内
- **重复值检查**：检查重复值

#### 计划检查
- **计划失败**：检查计划是否失败
- **计划延迟**：检查计划是否延迟
- **运行时长**：检查计划运行时间

## 与 Monitoring Views 的对比

### 何时使用 Health Checks

- 监控特定资源
- 需要详细的警报配置
- 资源数量较少且稳定

### 何时使用 Monitoring Views

- 需要监控健康检查未覆盖的资源
- 需要随着添加更多资源而扩展的覆盖范围
- 需要更简单的方式监控许多相似资源

## 最佳实践

### 1. 推荐的健康检查

参考 **maintaining pipelines** 文档中的 **recommended health checks** 获取设置有效健康检查的高级指导。

#### 关键检查
- **数据新鲜度**：确保数据及时更新
- **数据质量**：检查空值和异常值
- **架构稳定性**：检测意外的架构变更
- **大小验证**：验证数据集大小

### 2. 检查配置

- **阈值设置**：根据业务需求设置适当的阈值
- **通知配置**：配置适当的通知频率
- **严重级别**：设置正确的严重级别

### 3. 监控策略

- **分层监控**：在不同级别（管道、项目、平台）监控
- **关键数据集**：优先监控关键数据集
- **聚合视图**：使用聚合视图了解整体健康状况

## 工作流程

```
┌─────────────────────────────────────────────────────────────┐
│           Health Checks 工作流程                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 创建检查                                                │
│     ├── 选择资源类型                                       │
│     ├── 选择检查类型                                       │
│     ├── 配置检查参数                                       │
│     └── 设置通知                                           │
│     ↓                                                        │
│  2. 评估检查                                                │
│     ├── 自动执行                                           │
│     ├── 按计划执行                                         │
│     └── 手动触发                                           │
│     ↓                                                        │
│  3. 查看结果                                                │
│     ├── Health 选项卡                                      │
│     ├── Data Health 应用                                   │
│     └── Data Lineage                                       │
│     ↓                                                        │
│  4. 处理警报                                                │
│     ├── 接收通知                                           │
│     ├── 调查问题                                           │
│     ├── 修复问题                                           │
│     └── 验证修复                                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 通过代码创建检查

对于数据集，您也可以通过代码创建检查。这允许：

- **自动化**：自动化检查创建
- **版本控制**：将检查定义纳入版本控制
- **批量创建**：批量创建多个检查

## 通知和问题

### 通知机制

- **平台通知**：在 Foundry 界面中显示
- **电子邮件**：发送到配置的电子邮件地址
- **严重级别**：根据检查严重级别确定

### 问题管理

- **问题列表**：查看所有活动问题
- **问题详情**：查看问题的详细信息
- **问题解决**：标记问题为已解决

## 与其他功能集成

### Data Lineage

- **着色**：按健康状态对数据集着色
- **Data Health 选项卡**：显示所有检查的状态

### Data Health 应用

- **平台概览**：查看所有数据集的健康状况
- **过滤和排序**：按状态或名称过滤和排序
- **批量管理**：批量管理健康检查

### Monitoring Views

- **互补功能**：与监控视图互补
- **扩展覆盖**：监控健康检查未覆盖的资源

## 相关文档

- [Types of checks](https://palantir.com/docs/foundry/health-checks/types-of-checks/) - 检查类型
- [Check evaluation](https://palantir.com/docs/foundry/health-checks/check-evaluation/) - 检查评估
- [Watching checks](https://palantir.com/docs/foundry/health-checks/watching-checks/) - 关注检查
- [Notifications and issues](https://palantir.com/docs/foundry/health-checks/notifications/) - 通知和问题
- [Builds and checks FAQ](https://palantir.com/docs/foundry/health-checks/builds-checks-faq/) - 构建和检查常见问题
- [Checks reference](https://palantir.com/docs/foundry/health-checks/checks-reference/) - 检查参考

---

*本文档基于 Palantir Foundry 官方文档整理*
